const axios = require('axios');
const fs = require('fs');

// API Base URL
const API_URL = 'https://cvrapi.dk/api';

// User-Agent string as required by CVR API
const USER_AGENT = 'Wentzel ApS - EmailCollector - Alex Wentzel alex@example.com';

// Function to fetch data for a single CVR number
async function fetchEmailByCVR(cvrNumber) {
  try {
    const response = await axios.get(API_URL, {
      headers: { 'User-Agent': USER_AGENT },
      params: {
        search: cvrNumber,
        country: 'dk',
        format: 'json'
      }
    });

    let email = response.data.email;

    // Check if email is in productionunits array
    if (!email && response.data.productionunits && response.data.productionunits.length > 0) {
      email = response.data.productionunits[0].email;
    }

    email = email || 'No email available';
    console.log(`CVR: ${cvrNumber} - Email: ${email}`);
    return { cvr: cvrNumber, email };
  } catch (error) {
    console.error(`Error fetching email for CVR ${cvrNumber}:`, error.message);
    return { cvr: cvrNumber, email: null, error: error.message };
  }
}

// Function to process multiple CVR numbers and save emails to a file
async function gatherEmails(cvrNumbers) {
  const results = [];

  for (const cvr of cvrNumbers) {
    const emailData = await fetchEmailByCVR(cvr);
    if (emailData.email !== null) {
      results.push(emailData);
    }
  }

  // Save results to a JSON file
  fs.writeFileSync('emails.json', JSON.stringify(results, null, 2));
  console.log('Email data saved to emails.json');
}

// List of CVR numbers to process (replace with actual CVR numbers)
const cvrNumbers = ['30429427', '35585672', '20625406', '34109125', '31551544', '29958025', '37906913', '69716210', '25023765', '35628711', '28643179', '30108973', '33331037', '29343365', '31454891', '34327971', '33625782', '31790530', '19055876', '38519492', '25313704', '29259968', '21740306', '17367935', '14480102', '16036595', '19971384', '20011386', '27652824', '27681883', '27037267', '29594759', '30108604', '30844564', '30867963', '31127912', '33667825', '20774487', '27517161', '17303449', '27482414', '91299755', '17344234', '29946604', '39042827', '17755080', '14216707', '30881672', '27693504', '15673893', '34420009'
];


const cvrNumbers2 = [
  '34420009', '25962869', '35310487', '30134060', '21124389', 
  '20224541', '35711732', '30686950', '30028902', '29359679', 
  '29098220', '32135390', '31978556', '26165105', '21735744', 
  '33189095', '29671214', '28624387', '26420687', '33124376', 
  '34021058', '33406983', '33430558', '31818273', '35012443', 
  '32900100', '31337720', '20430036', '39425106', '38115561', 
  '32593429', '40171231', '38481207', '35995455', '39369494', 
  '37109290', '31409098', '51949056', '35019383', '30458087', 
  '34994374', '30634071', '18613492', '95194753', '61244816', 
  '27097030', '39149176', '32307655', '20851740', '77095012'
];

const cvrNumbers3 = [
  '30216539', '19953742', '12418299', '11523196', '13679533', 
  '20986085', '24976858', '21149233', '21319988', '20750634', 
  '21397601', '25314816', '36831510', '25810945', '28367481', 
  '29129401', '15212632', '18846780', '26825377', '27270298', 
  '35963480', '30386949', '30048571', '41504412', '33693192', 
  '37466786', '26359929', '28205449', '89141117', '19708497', 
  '73374456', '32506550', '20802774', '25304098', '17453076', 
  '35621458', '34846332', '29675120', '18134403', '19897397', 
  '21694142', '21191086', '30418387', '26953782', '20980893', 
  '20896876', '16658642', '17168878', '17748270', '17219839'
];

const cvrNumbers4 = [
  '18584530', '17339346', '19341798', '19937585', '25174534', 
  '39163659', '31724910', '31823242', '30876148', '31535611', 
  '31386292', '27629482', '29967997', '29868670', '30040155', 
  '21242594', '27554733', '12843135', '28008201', '25275802', 
  '25129431', '13933995', '33992688', '33517890', '28018886', 
  '27224253', '27486460', '52886252', '18495074', '35953612', 
  '89164613', '34165327', '27088694', '38176013', '16741671', 
  '32590802', '32672159', '35096876', '18391341', '25673166', 
  '33092148', '19897133', '35015930', '52938368', '19927008', 
  '35081496', '36151374', '35318291', '35910727', '39977028'
];

const cvrNumbers5 = [
  '75768915', '74074456', '33293135', '16493481', '14521283', 
  '10611296', '38126504', '37193089', '30972694', '30336194', 
  '35777555', '31567696', '67512618', '19103404', '26047420', 
  '33432860', '18434849', '34162395', '11447481', '17398806', 
  '25123808', '13338701', '15051884', '34035075', '12714483', 
  '29499004', '14304894', '26698197', '26852463', '17424300', 
  '14392033', '75399812', '34395772', '38111493', '38681362', 
  '21052787', '29856931', '13695598', '12504586', '28408137', 
  '35039716', '10571332', '12373104', '12264798', '14440291', 
  '14762892', '17742035', '17670131', '25282205', '26366976'
];

const cvrNumbers6 = [
  '25897331', '26460387', '19109046', '19060705', '22005073', 
  '28267053', '28617771', '13944199', '31686032', '32233945', 
  '37077410', '37817740', '38160427', '56553851', '33677456', 
  '32978487', '34936986', '25290542', '13506671', '26959039', 
  '47632013', '44529254', '39840855', '39317214', '34523746', 
  '12090595', '34759251', '16664634', '29452652', '14780432', 
  '34358524', '26895200', '26263883', '33944276', '31248728', 
  '33021119', '27136516', '21482374', '17122177', '37961345', 
  '72558154', '26463254', '26737060', '21124672', '21008702', 
  '13061092', '21309281', '18421984', '19060683', '34396043'
];

const cvrNumbers7 = [
  '34152896', '34248877', '35938613', '35948570', '34156506', 
  '36292296', '32730078', '33399480', '33186959', '33668333', 
  '15301058', '16935182', '25668081', '21305987', '37965871', 
  '36618906', '38023918', '30984536', '31126673', '28275528', 
  '29367272', '38489623', '12345593', '10607116', '34413967', 
  '52445817', '29188580', '21878545', '34863571', '36133767', 
  '31544424', '28360762', '34295506', '36608560', '44579510', 
  '26314232', '26726301', '39347776', '38813390', '39242311', 
  '20863900', '25212185', '67729919', '20593946', '38504843', 
  '12345402', '35363890', '37119571', '20365943', '35133720'
];

const cvrNumbers8 = [
  '19341399', '16909076', '30783646', '27608868', '36566256', 
  '18969777', '30843576', '19644596', '25298993', '26901596', 
  '33801475', '38598902', '26278872', '36008407', '33519257', 
  '26733030', '34838070', '25537580', '26163641', '26768004', 
  '26182093', '30062574', '30257375', '33109989', '38513745', 
  '34010277', '28837836', '32418538', '20128232', '38017403', 
  '34669643', '25701631', '29699003', '34135630', '35267832', 
  '35976426', '35117539', '32517730', '15456248', '17732897', 
  '21584193', '28035462', '74031951', '14386270', '29291713', 
  '25998502', '36290544', '77562613', '29078149', '25103548'
];

const cvrNumbers9 = [
  '27688551', '33299737', '27052894', '28350945'
];



gatherEmails(cvrNumbers6);